<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>m5n.github.io</title>
        <style>
html,
body {
    height: 100%;
    margin: 0;
    padding: 0;
    width: 100%;
}

body {
    background: black;
    color: #aaa;
    display: table;
    font-family: Fixed, monospace;
    line-height: 1.25
}

div {
    display: none;
}

p {
    display: table-cell;
    padding: 0.25em;
    vertical-align: bottom;
    white-space: pre;
}

span {
    background: #aaa;
    display: inline-block;
    height: 1em;
    position: relative;
    top: 0.2em;
    width: 0.55em;
}
        </style>
    </head>
    <body>
        <p><span></span></p>
        <div>
Connected to github.map.fastly.net (199.27.79.133)

................................................................................
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
 |    |    |       |       |    |         |      |   |         |  |    |     | 
      |  ._______          |        .__  __  .__     |   ___.     |  .__     |  
  _____  |  ____/ ____     |   ____ |__|/  |_|  |__  __ _\_ |__   |  |__| ____  
 /     \ |___  \ /    \       / ___\|  \   __\  |  \|  |  \ __ \     |  |/  _ \ 
|  Y Y  \/      \   |  \     / /_/  |  ||  | |   Y  \  |  / \_\ \    |  (  /_/ )
|__|_|  /_____  /___|  / /\  \___  /|__||__| |___|  /____/|___  / /\ |__|\____/ 
      \/      \/     \/  \/ /_____/               \/          \/  \/            
          |                            |    |          |               |
   |      |   |        |      |        |    |    |     |    |          |   |
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
................................................................................
.                                                                              .
. Welcome to m5n.github.io, home of Maarten van Egmond's open source goodness! .
.                                                                              .
................................................................................

Username: </div>
        <script>
/*global clearInterval, document, setInterval, setTimeout, window */
(function () {
    'use strict';

    var pNode = document.getElementsByTagName('p')[0],
        textNode = document.getElementsByTagName('div')[0],
        spanNode = document.getElementsByTagName('span')[0],
        scriptNode = document.getElementsByTagName('script')[0],
        timerId,
        index,
        callbackFn,
        text;

    function blink() {
        // Span gets rewritten every time, so cannot cache it.
        spanNode = document.getElementsByTagName('span')[0];
        spanNode.style.visibility = spanNode.style.visibility === 'hidden' ? 'visible' : 'hidden';
    }

    function echo(char) {
        var i = pNode.innerHTML.indexOf('<span'), // Could be <span style=...>
            prefix = pNode.innerHTML.substring(0, i);

        pNode.innerHTML = prefix + char + '<span></span>';

        if (char === '\n') {
            window.scrollTo(0, document.body.scrollHeight);
        }
    }

    function printChar() {
        clearInterval(timerId);
        spanNode = document.getElementsByTagName('span')[0];
        spanNode.style.visibility = 'visible';

        if (index === text.length) {
            timerId = setInterval(blink, 500);

            callbackFn();

            return;
        }

        echo(text.charAt(index));

        index += 1;
        setTimeout(printChar, 0);
    }

    function prepPrintChar(txt, cbFn) {
        text = txt;
        index = 0;
        callbackFn = cbFn;
        printChar();
    }

    function swallowEvent(e) {
        e.cancelBubble = true;
        if (e.stopPropagation) {
            e.stopPropagation();
        }
        if (e.preventDefault) {
            e.preventDefault();
        }
    }

    function processCtrlC() {
        prepPrintChar(
            '\nConnection terminated.',
            function () {
                // Stop blinking.
                clearInterval(timerId);
            }
        );

        // Stop listening for events.
        document.onkeydown = undefined;
        document.onkeypress = undefined;
    }

    function acceptCtrlC() {
        document.onkeypress = function (e) {
            var code;

            e = e || window.event;

            code = e.keyCode || e.which;
            switch (code) {
            case 67:   // 'C'
            case 99:   // 'c'
                if (e.ctrlKey) {
                    processCtrlC();
                }
                break;
            }
        };
    }

    function acceptInput() {
// TODO: create readInput(prompt, hidden) function
        var passwordInput = false;

        document.onkeydown = function (e) {
            e = e || window.event;
            var code = e.keyCode || e.which;
            if (code === 8) {   // Backspace
                /\n(.+?)<span/.test(pNode.innerHTML);   // Get last echoed line.
                if (RegExp.$1.length > 'Username: '.length) {
                    // Remove last char.
                    pNode.innerHTML = pNode.innerHTML.replace(/\n(.+?)<span/, '\n' + RegExp.$1.substring(0, RegExp.$1.length - 1) + '<span');
                }
                swallowEvent(e);   // Prevent browser doing history.back().
            }
        };
        document.onkeypress = function (e) {
            var code,
                print = true,
                swallow = true;

            e = e || window.event;

            // TODO: ignore any control character (PgUp, etc.)

            code = e.keyCode || e.which;
            switch (code) {
            case 13:   // Enter
                print = false;

                prepPrintChar(
                    passwordInput ? '\nUsername: ' : '\nPassword: ',
                    function () {
                        passwordInput = !passwordInput;
                    }
                );

                break;
            case 67:   // 'C'
            case 99:   // 'c'
                if (e.ctrlKey) {
                    print = false;

                    processCtrlC();
                }
                break;
            case 82:   // 'R'
            case 114:   // 'r'
                if (e.ctrlKey) {
                    print = false;
                    swallow = false;
                }
                break;
            }

            if (print) {
                echo(passwordInput ? '*' : String.fromCharCode(code));
            }

            if (swallow) {
                swallowEvent(e);   // Prevent browser default behavior.
            }
        };

        // TODO: Avoid the user needing to click anywhere first. (Use moved-offscreen input field?)
        pNode.focus();   // Doesn't work, perhaps need to do this after contents has been rendered?
    }

    scriptNode.parentNode.removeChild(scriptNode);
    textNode.parentNode.removeChild(textNode);

    timerId = setInterval(blink, 500);

    prepPrintChar('Connecting...', acceptCtrlC);

    setTimeout(function () {
        prepPrintChar(textNode.innerHTML, acceptInput);
    }, 4000);
}());
        </script>
    </body>
</html>

